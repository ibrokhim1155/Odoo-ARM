<?xml version="1.0" encoding="UTF-8"?>
<odoo>

  <record id="view_arm_production_task_list" model="ir.ui.view">
    <field name="name">arm.production.task.list</field>
    <field name="model">arm.production.task</field>
    <field name="arch" type="xml">
      <list string="Tasks"
            decoration-danger="state == 'defect' or state == 'blocked'"
            decoration-warning="state == 'in_progress'"
            decoration-success="state == 'done'">
        <field name="order_number"/>
        <field name="name"/>
        <field name="workstation_id"/>
        <field name="priority"/>
        <field name="state"/>
        <field name="qty"/>
        <field name="price"/>
        <field name="amount"/>
        <field name="assigned_user_id"/>
        <field name="start_time"/>
        <field name="end_time"/>
        <field name="duration_minutes"/>
      </list>
    </field>
  </record>

  <record id="view_arm_production_task_form" model="ir.ui.view">
    <field name="name">arm.production.task.form</field>
    <field name="model">arm.production.task</field>
    <field name="arch" type="xml">
      <form string="Task">
        <header>
          <button name="action_take_into_work" type="object"
                  string="Взять в работу"
                  class="btn-primary"
                  invisible="state not in ['ready','blocked']"/>
          <button name="action_mark_done" type="object"
                  string="Готово"
                  class="btn-success"
                  invisible="state != 'in_progress'"/>
          <button name="action_mark_defect" type="object"
                  string="Брак"
                  class="btn-danger"
                  invisible="state != 'in_progress'"/>
          <button name="action_mark_blocked" type="object"
                  string="Нет возможности"
                  class="btn-secondary"
                  invisible="state != 'in_progress'"/>

          <field name="state" widget="statusbar"
                 statusbar_visible="ready,in_progress,blocked,defect,done"/>
        </header>

        <sheet>
          <group>
            <group>
              <field name="order_number"/>
              <field name="name"/>
              <field name="workstation_id"/>
              <field name="assigned_user_id"/>
              <field name="operators" widget="many2many_tags" readonly="1"/>
              <field name="priority"/>
            </group>
            <group>
              <field name="planned_start"/>
              <field name="deadline"/>
              <field name="qty"/>
              <field name="price"/>
              <field name="amount" readonly="1"/>
            </group>
          </group>

          <notebook>
            <page string="Timing">
              <group>
                <field name="start_time"/>
                <field name="end_time"/>
                <field name="duration_minutes" readonly="1"/>
              </group>
            </page>
            <page string="Reasons">
              <group>
                <field name="defect_reason"/>
                <field name="blocked_reason"/>
              </group>
            </page>
            <page string="Files">
              <field name="attachment_ids" widget="many2many_binary"/>
            </page>
          </notebook>

          <div class="oe_chatter">
            <field name="message_follower_ids"/>
            <field name="message_ids"/>
          </div>
        </sheet>
      </form>
    </field>
  </record>

  <record id="action_arm_production_task" model="ir.actions.act_window">
    <field name="name">Tasks</field>
    <field name="res_model">arm.production.task</field>
    <field name="view_mode">list,form</field>
  </record>

  <record id="view_arm_production_task_search" model="ir.ui.view">
    <field name="name">arm.production.task.search</field>
    <field name="model">arm.production.task</field>
    <field name="arch" type="xml">
      <search>
        <field name="order_number"/>
        <field name="name"/>
        <field name="workstation_id"/>
        <filter name="ready" string="Ready" domain="[('state','=','ready')]"/>
        <filter name="in_progress" string="In Progress" domain="[('state','=','in_progress')]"/>
        <filter name="blocked" string="Blocked" domain="[('state','=','blocked')]"/>
        <filter name="defect" string="Defect" domain="[('state','=','defect')]"/>
        <filter name="done" string="Done" domain="[('state','=','done')]"/>
        <separator/>
        <filter name="high" string="High Priority" domain="[('priority','=','2')]"/>
      </search>
    </field>
  </record>

</odoo>
